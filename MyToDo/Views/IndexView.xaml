<UserControl x:Class="MyToDo.Views.IndexView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MyToDo.Views"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:converter="clr-namespace:MyToDo.Common.converter"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <converter:IntToBoolConvertercs x:Key="IntToBool"/>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <!--第一行内容-->
        <TextBlock Text="{Binding Title}" 
                   FontFamily="Times New Roman" FontSize="20"
                   FontWeight="Bold" Margin="10,10" FontStyle="Normal"/>
        
        <!--第二行内容-->
        <Grid Grid.Row="1">
            <ItemsControl ItemsSource="{Binding TaskBars}">
                <!--布局容器模板，用ItemsSource绑定属性-->
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="4"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <!--自定义模板-->
                    <DataTemplate>
                        <Border Style="{StaticResource TaskBarStyle}" Background="{Binding Bordercolor}" CornerRadius="10" Margin="10,4">
                            <Border.InputBindings>
                                <MouseBinding MouseAction="LeftClick"
                                              Command="{Binding DataContext.NavigateCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                                              CommandParameter="{Binding}"/>
                            </Border.InputBindings>
                            <Grid><!--防止border仅添加一个元素-->
                                <!--边框、填充背景颜色等-->
                                <StackPanel>
                                    <materialDesign:PackIcon Kind="{Binding Icon}" Width="40" Height="40" Margin="10,5"/>
                                    <TextBlock Text="{Binding Title}" FontSize="25" Margin="10,2,2,2" FontWeight="Bold" FontStyle="Normal" FontFamily="Times New Roman"/>
                                    <TextBlock Text="{Binding Concent}" FontSize="40" FontWeight="Bold" Margin="10,5" FontStyle="Normal" FontFamily="Times New Roman"/>
                                </StackPanel>

                                <Canvas ClipToBounds="True">
                                    <Border Canvas.Top="10" Canvas.Right="-50" Width="120" Height="120" Background="#FFFFFF" CornerRadius="100" Opacity="0.1"/>
                                    <Border Canvas.Top="80" Canvas.Right="-30" Width="120" Height="120" Background="#FFFFFF" CornerRadius="100" Opacity="0.1"/>
                                </Canvas>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>

        <!--第三行内容-->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>

            <!--第一列内容-->
            <Border Background="#19BEBEBE" CornerRadius="5" Margin="10,8">
                <DockPanel LastChildFill="True" >
                    <DockPanel LastChildFill="False" DockPanel.Dock="Top" >
                        <TextBlock Text="待办事项" FontSize="20"  FontWeight="Bold" Margin="10,10,5,5"/>
                        <Button Style="{StaticResource MaterialDesignFloatingActionButton}" Margin="10,5" Width="30" Height="30" 
                                DockPanel.Dock="Right" VerticalAlignment="Top"
                                Command="{Binding ExecuteCommand}" CommandParameter="新增待办">
                            <materialDesign:PackIcon Kind="Add"/>
                        </Button>
                    </DockPanel>

                    <ListBox ItemsSource="{Binding Summary.ToDoList}" HorizontalContentAlignment="Stretch" x:Name="todoList">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="MouseDoubleClick">
                                <i:InvokeCommandAction Command="{Binding EditToDoCommand}" CommandParameter="{Binding ElementName=todoList, Path=SelectedItem}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <DockPanel LastChildFill="False" >
                                    <ToggleButton DockPanel.Dock="Right" Margin="0,0,5,0" 
                                                  Command="{Binding DataContext.CompltedtodoCommand, RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=ItemsControl}}"
                                                  CommandParameter="{Binding}"
                                                  IsChecked="{Binding Status, Converter={StaticResource IntToBool}}"/>
                                    <StackPanel MaxHeight="50">
                                        <TextBlock Text="{Binding Title}" FontSize="17" FontWeight="Bold" Margin="2,3" FontStyle="Normal" FontFamily="Times New Roman"/>
                                        <TextBlock Text="{Binding Content}" Opacity="0.5" Margin="2,3" FontStyle="Normal" FontFamily="Times New Roman"/>
                                    </StackPanel>
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>
            
            <!--第二列内容-->
            <Border Grid.Column="1" Background="#19BEBEBE" CornerRadius="5" Margin="10,8">
                <DockPanel LastChildFill="True" >
                    <DockPanel LastChildFill="False" DockPanel.Dock="Top">
                        <TextBlock Text="备忘录" FontSize="20"  FontWeight="Bold" Margin="10,10,5,5"/>
                        <Button Style="{StaticResource MaterialDesignFloatingActionButton}" Margin="10,5" Width="30" Height="30" 
                                DockPanel.Dock="Right" VerticalAlignment="Top"
                                Command="{Binding ExecuteCommand}" CommandParameter="新增备忘">
                            <materialDesign:PackIcon Kind="Add"/>
                        </Button>
                    </DockPanel>

                    <ListBox ItemsSource="{Binding Summary.MemoList}" HorizontalContentAlignment="Stretch" x:Name="memoList">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="MouseDoubleClick">
                                <i:InvokeCommandAction Command="{Binding EditMemoCommand}" CommandParameter="{Binding ElementName=memoList, Path=SelectedItem}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <DockPanel LastChildFill="False">
                                    <!--<ToggleButton DockPanel.Dock="Right" Margin="0,0,5,0"/>-->
                                    <StackPanel MaxHeight="50">
                                        <TextBlock Text="{Binding Title}" FontSize="17" FontWeight="Bold" Margin="2,3" FontStyle="Normal" FontFamily="Times New Roman"/>
                                        <TextBlock Text="{Binding Content}" Opacity="0.5" Margin="2,3" FontStyle="Normal" FontFamily="Times New Roman"/>
                                    </StackPanel>
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                </DockPanel>
            </Border>
            
        </Grid>
   
    </Grid>
</UserControl>
